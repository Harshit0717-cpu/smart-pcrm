<!DOCTYPE html>
<html>
<head>
<title>Citizen Portal</title>
<style>
body{font-family:Arial;background:#eef2f7;padding:20px}

.container{
  max-width:500px;
  margin:auto;
  background:white;
  padding:20px;
  border-radius:10px;
  margin-bottom:20px;
}

input,textarea,button{
  width:100%;
  padding:10px;
  margin-top:10px;
}

button{
  background:#22c55e;
  color:white;
  border:none;
}

table{
  width:100%;
  border-collapse:collapse;
  background:white;
  border-radius:10px;
  overflow:hidden;
}

th{
  background:#2563eb;
  color:white;
  padding:10px;
}

td{
  padding:8px;
  text-align:center;
  border-bottom:1px solid #eee;
}

.status{
  padding:4px 10px;
  border-radius:10px;
  color:white;
  font-size:12px;
}

.resolved{background:#16a34a}
.progress{background:#3b82f6}
.assigned{background:#f59e0b}

img{width:50px;border-radius:5px}
</style>
</head>

<body>

<div class="container">
<h2>Submit Complaint</h2>
<input id="issue" placeholder="Describe issue">
<input id="ward" placeholder="Ward number">
<input type="file" id="photo">
<button onclick="submitComplaint()">Submit</button>
<p id="msg"></p>
</div>

<h2>Your Complaints</h2>

<table>
<thead>
<tr>
<th>Issue</th>
<th>Ward</th>
<th>Status</th>
<th>Dept</th>
<th>Photo</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>

<script>
async function submitComplaint(){
  const form = new FormData();
  form.append("issue", issue.value);
  form.append("ward", ward.value);
  if(photo.files[0]) form.append("photo", photo.files[0]);

  const res = await fetch("/complaints",{
    method:"POST",
    body:form,
    credentials:"include"
  });

  const data = await res.json();
  msg.innerText="Submitted!";
  loadComplaints();
}

async function loadComplaints(){
  const res = await fetch("/complaints",{credentials:"include"});
  const data = await res.json();

  const table=document.getElementById("table");
  table.innerHTML="";

  data.forEach(c=>{
    const row=document.createElement("tr");

    const statusClass =
      c.status==="Resolved" ? "resolved" :
      c.status==="In Progress" ? "progress" :
      "assigned";

    row.innerHTML=`
      <td>${c.issue}</td>
      <td>${c.ward}</td>
      <td><span class="status ${statusClass}">${c.status}</span></td>
      <td>${c.assigned_to}</td>
      <td>${c.photo ? `<img src="/uploads/${c.photo}">` : "â€”"}</td>
    `;

    table.appendChild(row);
  });
}

loadComplaints();
</script>

</body>
</html>